<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset=”utf-8”>
	<title>US Sunbelt Population Change 1960-2020</title>
		
		<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css">
  		<link rel="stylesheet" href="https://unpkg.com/leaflet@1.8.0/dist/leaflet.css"
   		integrity="sha512-hoalWLoI8r4UszCkZ5kL8vayOGVae1oxXe/2A4AO6J9+580uKHDO3JdHb7NzwwzK5xr/Fs0W40kiNHxM9vyTtQ=="
   		crossorigin=""/>
  		<script src="https://unpkg.com/leaflet@1.8.0/dist/leaflet.js"
  		integrity="sha512-BB3hKbKWOc9Ez/TAwyWxNXeoV9c1v6FIeYiBieIWkpLjauysF18NzgR1MBNBXf8/KABdlkX68nAhlwcDFLGPCQ=="
   		crossorigin=""></script>
   		<meta name="viewport" content="width=device-width, initial-scale=1">
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
					     
<style>
    h1 {text-align: center;}
    h2 {text-align: center;}
    p {text-align: center;}
body {
  background-color: #e4ca00;
}
	  * {
      font-family: Georgia;
      color: #8B4000;
      }
	    #map{
         max-width: 85%;
         height: 650px;
         border: 3px solid #8B4000;
         margin-left:auto;
         margin-right:auto;
         }
	.leaflet-popup-content p {
    margin: 0.2em 0;
}
	#panel {
    width: 26%;
    padding: 20px;
    display: inline-block;
    vertical-align: top;
    text-align: center;
    line-height: 42px;
}

</style>
</head>
 <body>
	<h2>Sunbelt Cities Growth 1960-2020</h2>
  	<div id="map"></div>
	<script type="text/javascript">
			
	function createMap(){
		var map = L.map('map', {
				 center: [33.75625378639266, -99.40273321448059],
				 zoom: 5
			});
		
		L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
    				maxZoom: 15,
   				attribution: '© OpenStreetMap'}).addTo(map);
	
		getData(map);
	};

	function calcPropRadius(attValue) {
    		var scaleFactor = 60;
    		var area = attValue * scaleFactor;
    		var radius = Math.sqrt(area/Math.PI);

    		return radius;
	};
		
	function pointToLayer(feature, latlng){
		var attribute = "pop_2020";
    		var options = {
        		fillColor: "#ff7800",
        		color: "#000",
        		weight: 1,
        		opacity: 1,
        		fillOpacity: 0.8
    		};
		
		var attValue = Number(feature.properties[attribute]);
		options.radius = calcPropRadius(attValue);
		var layer = L.circleMarker(latlng, options);
		var popupContent = "<p><b>City:</b> " + feature.properties.city + "</p>";
		var year = attribute.split("_")[1];
    		popupContent += "<p><b>Population in " + year + ":</b> " + feature.properties[attribute] + " million</p>";
		layer.bindPopup(popupContent, {
			offset: new L.Point(0,-options.radius)
    		});
		return layer;
		layer.on({
        		mouseover: function(){
            			this.openPopup();
        		},
        		mouseout: function(){
            			this.closePopup();
        		}
    		});
	};

	function createPropSymbols(data, map){
		L.geoJson(data, {
        		pointToLayer: pointToLayer
    		}).addTo(map);
	};
		
	function getData(map){
    		$.ajax("cityData.geojson", {
        	dataType: "json",
        	success: function(response){
            	createPropSymbols(response, map);
       		}
    		});
	};

	$(document).ready(createMap);
		
	sliderControl = L.control.sliderControl({
                    position: "topright",
                    layer: pointToLayer, 
                    timeAttribute: attValue,
                    showAllOnStart: true,
                    range: true
	 }).addTo(map);
	 </script>	
</body>
</html>
